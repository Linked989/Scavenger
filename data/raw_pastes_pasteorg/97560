b' <!DOCTYPE html> <html lang="en"> <head> <meta charset="utf-8"> <meta http-equiv="X-UA-Compatible" content="IE=edge"> <meta name="viewport" content="width=device-width, initial-scale=1">  <meta name="description" content="www.paste.org - allows users to paste snippets of text, usually samples of source code, for public viewing."> <meta name="author" content="An Australian"> <link rel="icon" href="/favicon.ico"> <title>Paste code - paste.org</title>  <link href="/assets/themes/bleh/css/github-highlight.css" rel="stylesheet"> <script src="/assets/themes/bleh/js/highlight.pack.js"></script> <script>hljs.initHighlightingOnLoad();</script> </head> <body> <p><pre><code class="python">#!/usr/bin/python\r\n&amp;#039;&amp;#039;&amp;#039;\r\n\torig author: Igor Maculan - <a href="/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="513f622625233e3f11363c30383d7f323e3c">[email&#160;protected]</a>\r\n\tA Simple mjpg stream http server\r\n&amp;#039;&amp;#039;&amp;#039;\r\nimport cv2\r\nfrom BaseHTTPServer import BaseHTTPRequestHandler,HTTPServer\r\nimport time\r\nfrom SocketServer import ThreadingMixIn\r\nfrom threading import Thread\r\nimport os\r\n\r\ncapture=None\r\nimgBuf = None\r\n\r\nclass CamHandler(BaseHTTPRequestHandler):\r\n\tdef do_GET(self):\r\n\t\tprint self.path\r\n\t\tif self.path.endswith(&amp;#039;.mjpg&amp;#039;):\r\n\t\t\tself.send_response(200)\r\n\t\t\tself.send_header(&amp;#039;Content-type&amp;#039;,&amp;#039;multipart/x-mixed-replace; boundary=--jpgboundary&amp;#039;)\r\n\t\t\tself.end_headers()\r\n\t\t\twhile True:\r\n\t\t\t\ttry:\r\n\t\t\t\t\t&amp;#039;&amp;#039;&amp;#039;\r\n\t\t\t\t\trc,img = capture.read()\r\n\t\t\t\t\tif not rc:\r\n\t\t\t\t\t\tcontinue\r\n\t\t\t\t\t#imgRGB = cv2.cvtColor(img,cv2.COLOR_BGR2RGB)\r\n\t\t\t\t\tr, buf = cv2.imencode(&quot;.jpg&quot;,img)\r\n\t\t\t\t\t&amp;#039;&amp;#039;&amp;#039;\r\n\t\t\t\t\t#buf = open(imgPath, &amp;#039;rb&amp;#039;).read()\r\n\t\t\t\t\tself.wfile.write(&quot;--jpgboundary\\r\\n&quot;)\r\n\t\t\t\t\tself.send_header(&amp;#039;Content-type&amp;#039;,&amp;#039;image/jpeg&amp;#039;)\r\n\t\t\t\t\tself.send_header(&amp;#039;Content-length&amp;#039;,str(len(imgBuf)))\r\n\t\t\t\t\tself.end_headers()\r\n\t\t\t\t\tself.wfile.write(bytearray(imgBuf))\r\n\t\t\t\t\tself.wfile.write(&amp;#039;\\r\\n&amp;#039;)\r\n\t\t\t\t\ttime.sleep(0.3)\r\n\t\t\t\texcept KeyboardInterrupt:\r\n\t\t\t\t\tbreak\r\n\t\t\treturn\r\n\t\tif self.path.endswith(&amp;#039;.html&amp;#039;) or self.path==&quot;/&quot;:\r\n\t\t\tself.send_response(200)\r\n\t\t\tself.send_header(&amp;#039;Content-type&amp;#039;,&amp;#039;text/html&amp;#039;)\r\n\t\t\tself.end_headers()\r\n\t\t\tself.wfile.write(&amp;#039;&lt;html&gt;&lt;head&gt;&lt;/head&gt;&lt;body&gt;&amp;#039;)\r\n\t\t\tself.wfile.write(&amp;#039;&lt;img src=&quot;http://127.0.0.1:9090/cam.mjpg&quot;/&gt;&amp;#039;)\r\n\t\t\tself.wfile.write(&amp;#039;&lt;/body&gt;&lt;/html&gt;&amp;#039;)\r\n\t\t\treturn\r\n\r\ndef capturer():\r\n\tglobal imgBuf\r\n\tstopCap = False\r\n\twhile not stopCap:\r\n\t\trc,img = capture.read()\r\n\t\tif not rc:\r\n\t\t\tcontinue\r\n\t\t#cv2.imwrite(imgPath, img)\r\n\t\tr,imgBuf = cv2.imencode(&quot;.jpg&quot;, img)\r\n\t\t#open(imgPath, &amp;#039;wb&amp;#039;).write(buf)\r\n\t\ttime.sleep(0.5)\r\n\r\nclass ThreadingHTTPServer(ThreadingMixIn, HTTPServer):\r\n\tpass\r\n\r\ndef main():\r\n\tglobal capture, imgPath, stopCap\r\n\timgPath = &quot;/tmp/img.mjpg&quot;\r\n\tcapture = cv2.VideoCapture(0)\r\n\tcapture.set(cv2.CAP_PROP_FRAME_WIDTH, 320);\r\n\tcapture.set(cv2.CAP_PROP_FRAME_HEIGHT, 240);\r\n\tThread(target=capturer).start()\r\n\ttry:\r\n\t\tserver = ThreadingHTTPServer((&amp;#039;0.0.0.0&amp;#039;,9090),CamHandler)\r\n\t\tprint &quot;server started&quot;\r\n\t\tserver.serve_forever()\r\n\texcept KeyboardInterrupt:\r\n\t\tstopCap = True\r\n\t\tcapture.release()\r\n\t\t#server.socket.close()\r\n\t\tserver.shutdown()\r\n\t\tos._exit(0)\r\n\r\nif __name__ == &amp;#039;__main__&amp;#039;:\r\n\tmain()</code></pre></p> <p align="right"><span style="font-size: 60%">Add a code snippet to your website: <a href="https://www.paste.org" target="_blank">www.paste.org</a></span></p> <script data-cfasync="false" src="/cdn-cgi/scripts/5c5dd728/cloudflare-static/email-decode.min.js"></script></body> </html>'