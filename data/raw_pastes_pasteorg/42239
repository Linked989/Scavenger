b' <!DOCTYPE html> <html lang="en"> <head> <meta charset="utf-8"> <meta http-equiv="X-UA-Compatible" content="IE=edge"> <meta name="viewport" content="width=device-width, initial-scale=1">  <meta name="description" content="www.paste.org - allows users to paste snippets of text, usually samples of source code, for public viewing."> <meta name="author" content="An Australian"> <link rel="icon" href="/favicon.ico"> <title>Paste code - paste.org</title>  <link href="/assets/themes/bleh/css/github-highlight.css" rel="stylesheet"> <script src="/assets/themes/bleh/js/highlight.pack.js"></script> <script>hljs.initHighlightingOnLoad();</script> </head> <body> <p><pre><code class="csharp">// Proceso:     Alta de Sujeto Basica\n// Creacion:    2009-10-08\n// Autor:       Carlos Ijelchuk\n//****************************************************\n//  PRINCIPAL\n//****************************************************\n\ndo \'Valida\'\ndo \'Alta Sujeto\'\ndo \'Alta Domicilios\'\ndo \'Alta Atributos\' //Add -006-\ndo \'Finaliza\'\n\n\nsub \'Valida\'\n//Validar todos los campos mandatarios del XML marcados con una (M) con sus valores posibles.\n    if &amp;Request;.CiaCod.IsEmpty()\n        &amp;ErrorC; = \'ERR\'\n        &amp;ErrCod; = 103\n        call(PRecuperaDescripcionError, &amp;ErrCod;, &amp;ErrDesc; )\n        &amp;ErrorItem;.ErrCod = &amp;ErrCod; &amp;ErrorItem;.ErrDescripcion = &amp;ErrDesc; &amp;ErrorItem;.ErrDetalle = \'El C\xc3\xb3digo de Compa\xc3\xb1\xc3\xada no puede ser nulo.\'\n        &amp;Messages;.Add(&amp;ErrorItem;)\n        &amp;ErrorItem; = New XML_Errores.Error()\n    else\n        for each\n        where CiaCod = &amp;Request;.CiaCod\n            //ok\n        when none\n            &amp;ErrorC;= \'ERR\'\n            &amp;ErrCod; = 102\n            call(PRecuperaDescripcionError, &amp;ErrCod;, &amp;ErrDesc; )\n            &amp;ErrorItem;.ErrCod = &amp;ErrCod; &amp;ErrorItem;.ErrDescripcion = &amp;ErrDesc; &amp;ErrorItem;.ErrDetalle = \'No existe el C\xc3\xb3digo de Compa\xc3\xb1\xc3\xada indicado.\'\n            &amp;Messages;.Add(&amp;ErrorItem;)\n            &amp;ErrorItem; = New XML_Errores.Error()\n        endfor\n    endif\n    if &amp;Request;.DocTpo.IsEmpty()\n        &amp;ErrorC;= \'ERR\'\n        &amp;ErrCod; = 103\n        call(PRecuperaDescripcionError, &amp;ErrCod;, &amp;ErrDesc; )\n        &amp;ErrorItem;.ErrCod = &amp;ErrCod; &amp;ErrorItem;.ErrDescripcion = &amp;ErrDesc; &amp;ErrorItem;.ErrDetalle = \'El Tipo de Documento no puede ser nulo.\'\n        &amp;Messages;.Add(&amp;ErrorItem;)\n        &amp;ErrorItem; = New XML_Errores.Error()\n    else\n        &amp;TpoDocId; = &amp;Request;.DocTpo\n        for each\n        where TPODOCId = &amp;TpoDocId; //OK\n        when none\n            &amp;ErrorC;= \'ERR\'\n            &amp;ErrCod; = 102\n            call(PRecuperaDescripcionError, &amp;ErrCod;, &amp;ErrDesc; )\n            &amp;ErrorItem;.ErrCod = &amp;ErrCod; &amp;ErrorItem;.ErrDescripcion = &amp;ErrDesc; &amp;ErrorItem;.ErrDetalle = \'El Tipo de Documento indicado no existe.\'\n            &amp;Messages;.Add(&amp;ErrorItem;)\n            &amp;ErrorItem; = New XML_Errores.Error()\n        endfor\n    endif\n    if &amp;Request;.DocNro.IsEmpty()\n        &amp;ErrorC;= \'ERR\'\n        &amp;ErrCod; = 103\n        call(PRecuperaDescripcionError, &amp;ErrCod;, &amp;ErrDesc; )\n        &amp;ErrorItem;.ErrCod = &amp;ErrCod; &amp;ErrorItem;.ErrDescripcion = &amp;ErrDesc; &amp;ErrorItem;.ErrDetalle = \'El N\xc3\xbamero de Documento no puede ser nulo.\'\n        &amp;Messages;.Add(&amp;ErrorItem;)\n        &amp;ErrorItem; = New XML_Errores.Error()\n    endif\n    if &amp;Request;.RazonSocial.IsEmpty()\n        &amp;ErrorC;= \'ERR\'\n        &amp;ErrCod; = 103\n        call(PRecuperaDescripcionError, &amp;ErrCod;, &amp;ErrDesc; )\n        &amp;ErrorItem;.ErrCod = &amp;ErrCod; &amp;ErrorItem;.ErrDescripcion = &amp;ErrDesc; &amp;ErrorItem;.ErrDetalle = \'La Razo\xc3\xb3n Social no puede ser nula.\'\n        &amp;Messages;.Add(&amp;ErrorItem;)\n        &amp;ErrorItem; = New XML_Errores.Error()\n    endif\n    if &amp;Request;.ContactoNombre.IsEmpty()\n        &amp;ErrorC;= \'ERR\'\n        &amp;ErrCod; = 103\n        call(PRecuperaDescripcionError, &amp;ErrCod;, &amp;ErrDesc; )\n        &amp;ErrorItem;.ErrCod = &amp;ErrCod; &amp;ErrorItem;.ErrDescripcion = &amp;ErrDesc; &amp;ErrorItem;.ErrDetalle = \'El Nombre del Contacto no puede ser nulo.\'\n        &amp;Messages;.Add(&amp;ErrorItem;)\n        &amp;ErrorItem; = New XML_Errores.Error()\n    endif\n    if &amp;Request;.ContactoApellido.IsEmpty()\n        &amp;ErrorC;= \'ERR\'\n        &amp;ErrCod; = 103\n        call(PRecuperaDescripcionError, &amp;ErrCod;, &amp;ErrDesc; )\n        &amp;ErrorItem;.ErrCod = &amp;ErrCod; &amp;ErrorItem;.ErrDescripcion = &amp;ErrDesc; &amp;ErrorItem;.ErrDetalle = \'El Apellido del Contacto no puede ser nulo.\'\n        &amp;Messages;.Add(&amp;ErrorItem;)\n        &amp;ErrorItem; = New XML_Errores.Error()\n    endif\n    if &amp;Request;.ContactoTel.IsEmpty()\n        &amp;ErrorC;= \'ERR\'\n        &amp;ErrCod; = 103\n        call(PRecuperaDescripcionError, &amp;ErrCod;, &amp;ErrDesc; )\n        &amp;ErrorItem;.ErrCod = &amp;ErrCod; &amp;ErrorItem;.ErrDescripcion = &amp;ErrDesc; &amp;ErrorItem;.ErrDetalle = \'El Tel\xc3\xa9fono del Contacto no puede ser nulo.\'\n        &amp;Messages;.Add(&amp;ErrorItem;)\n        &amp;ErrorItem; = New XML_Errores.Error()\n    endif\n    if &amp;Request;.ContactoMail.IsEmpty()\n        &amp;ErrorC;= \'ERR\'\n        &amp;ErrCod; = 103\n        call(PRecuperaDescripcionError, &amp;ErrCod;, &amp;ErrDesc; )\n        &amp;ErrorItem;.ErrCod = &amp;ErrCod; &amp;ErrorItem;.ErrDescripcion = &amp;ErrDesc; &amp;ErrorItem;.ErrDetalle = \'El Mail del Contacto no puede ser nulo.\'\n        &amp;Messages;.Add(&amp;ErrorItem;)\n        &amp;ErrorItem; = New XML_Errores.Error()\n    endif\n    if &amp;Request;.Audit_Sistema.IsEmpty()\n        &amp;ErrorC;= \'ERR\'\n        &amp;ErrCod; = 103\n        call(PRecuperaDescripcionError, &amp;ErrCod;, &amp;ErrDesc; )\n        &amp;ErrorItem;.ErrCod = &amp;ErrCod; &amp;ErrorItem;.ErrDescripcion = &amp;ErrDesc; &amp;ErrorItem;.ErrDetalle = \'El Sistema no puede ser nulo.\'\n        &amp;Messages;.Add(&amp;ErrorItem;)\n        &amp;ErrorItem; = New XML_Errores.Error()\n    endif\n    if &amp;Request;.Audit_Usuario.IsEmpty()\n        &amp;ErrorC;= \'ERR\'\n        &amp;ErrCod; = 103\n        call(PRecuperaDescripcionError, &amp;ErrCod;, &amp;ErrDesc; )\n        &amp;ErrorItem;.ErrCod = &amp;ErrCod; &amp;ErrorItem;.ErrDescripcion = &amp;ErrDesc; &amp;ErrorItem;.ErrDetalle = \'El Usuario no puede ser nulo.\'\n        &amp;Messages;.Add(&amp;ErrorItem;)\n        &amp;ErrorItem; = New XML_Errores.Error()\n    endif\n    //Tipo y N\xc3\xbamero de documento son obligatorios y no debe existir en la tabla PERSUJ\n    if not &amp;Request;.DocNro.IsEmpty() and not &amp;Request;.DocTpo.IsEmpty()\n        &amp;PerCui; = &amp;Request;.DocNro\n        for each\n        where TPODOCId = &amp;TpoDocId; where PerCUI = &amp;PerCui; &amp;ErrorC;= \'ERR\'\n            &amp;ErrCod; = 101\n            call(PRecuperaDescripcionError, &amp;ErrCod;, &amp;ErrDesc; )\n            &amp;ErrorItem;.ErrCod = &amp;ErrCod; &amp;ErrorItem;.ErrDescripcion = &amp;ErrDesc; &amp;ErrorItem;.ErrDetalle = \'El Sujeto que intenta dar de alta ya existe.\'\n            &amp;Messages;.Add(&amp;ErrorItem;)\n            &amp;ErrorItem; = New XML_Errores.Error()            \n        endfor\n    endif\n    //Raz\xc3\xb3n Social es obligatoria y no debe existir ning\xc3\xban sujeto con la misma raz\xc3\xb3n social en la tabla PERSUJ.\n    if not &amp;Request;.RazonSocial.IsEmpty()\n        &amp;PerNom; = upper(trim(&amp;Request;.RazonSocial))\n        for each\n        where upper(trim(PerNom)) = &amp;PerNom; &amp;ErrorC;= \'ERR\'\n            &amp;ErrCod; = 101\n            call(PRecuperaDescripcionError, &amp;ErrCod;, &amp;ErrDesc; )\n            &amp;ErrorItem;.ErrCod = &amp;ErrCod; &amp;ErrorItem;.ErrDescripcion = &amp;ErrDesc; &amp;ErrorItem;.ErrDetalle = \'Ya existe un Sujeto con la misma Razon Social.\'\n            &amp;Messages;.Add(&amp;ErrorItem;)\n            &amp;ErrorItem; = New XML_Errores.Error()            \n        endfor\n    endif\n    //Si trae alg\xc3\xban valor la Cuenta Bancaria, los valores posibles son [CA=Caja Ahorro ; CC=Cuenta Corriente ; OO=Otro]\n    if &amp;Request;.TpoCtaBco &lt;&gt; \'CA\' and &amp;Request;.TpoCtaBco &lt;&gt; \'CC\' and &amp;Request;.TpoCtaBco &lt;&gt; \'OO\'\n        &amp;ErrorC;= \'ERR\'\n        &amp;ErrCod; = 103\n        call(PRecuperaDescripcionError, &amp;ErrCod;, &amp;ErrDesc; )\n        &amp;ErrorItem;.ErrCod = &amp;ErrCod; &amp;ErrorItem;.ErrDescripcion = &amp;ErrDesc; &amp;ErrorItem;.ErrDetalle = \'Valor inv\xc3\xa1lido en Tipo de Cuenta Bancaria [CA=Caja Ahorro ; CC=Cuenta Corriente ; OO=Otro].\'\n        &amp;Messages;.Add(&amp;ErrorItem;)\n        &amp;ErrorItem; = New XML_Errores.Error()            \n    endif\n    //Si es sujeto extranjero, debe indicar C\xc3\xb3digo de Pa\xc3\xads y el tipo de sujeto extranjero\n    if not (&amp;Request;.SujExtranjero.IsEmpty())\n        if not &amp;Request;.CodPais.IsEmpty() \n            &amp;PaisId; = &amp;Request;.CodPais\n            for each\n            where PAISId = &amp;PaisId; //OK\n            when none\n                &amp;ErrorC;= \'ERR\'\n                &amp;ErrCod; = 102\n                call(PRecuperaDescripcionError, &amp;ErrCod;, &amp;ErrDesc; )\n                &amp;ErrorItem;.ErrCod = &amp;ErrCod; &amp;ErrorItem;.ErrDescripcion = &amp;ErrDesc; &amp;ErrorItem;.ErrDetalle = \'No existe el Codigo de Pa\xc3\xads indicado.\'\n                &amp;Messages;.Add(&amp;ErrorItem;)\n                &amp;ErrorItem; = New XML_Errores.Error()                   \n            endfor\n        else\n            //{ADD-008\n            //recorre coleccion de atributos del sujeto buscando si CNTR tiene valor\n            &amp;OK;_Pais = 0\n            for &amp;Atributo; in &amp;Request;.Atributos\n                if &amp;Atributo;.CodAtributo=\'CNTR\' and &amp;Atributo;.Valor &lt;&gt; \'\'\n                    &amp;Ok;_Pais = 1\n                endif\n            endfor\n            //-008}\n            if &amp;OK;_PAis = 0 //{-008-}\n                &amp;ErrorC;= \'ERR\'\n                &amp;ErrCod; = 103\n                call(PRecuperaDescripcionError, &amp;ErrCod;, &amp;ErrDesc; )\n                &amp;ErrorItem;.ErrCod = &amp;ErrCod; &amp;ErrorItem;.ErrDescripcion = &amp;ErrDesc; &amp;ErrorItem;.ErrDetalle = \'El Codigo de Pa\xc3\xads no puede ser nulo.\'\n                &amp;Messages;.Add(&amp;ErrorItem;)\n                &amp;ErrorItem; = New XML_Errores.Error()   \n            endif\n        endif\n//        if &amp;Request;.TpoSujExtranjero.IsEmpty() or &amp;Request;.TpoSujExtranjero &lt; 0 or &amp;Request;.TpoSujExtranjero &gt; 2  //[0=Persona Jur\xc3\xaddica; 1=Persona F\xc3\xadsica; 2=Otro] //DEL -004-\n        if &amp;Request;.TpoSujExtranjero &lt;&gt; 0 and &amp;Request;.TpoSujExtranjero &lt;&gt; 1 and &amp;Request;.TpoSujExtranjero &lt;&gt; 2  //[0=Persona Jur\xc3\xaddica; 1=Persona F\xc3\xadsica; 2=Otro] //UPD -004-\n            &amp;ErrorC;= \'ERR\'\n            &amp;ErrCod; = 103\n            call(PRecuperaDescripcionError, &amp;ErrCod;, &amp;ErrDesc; )\n            &amp;ErrorItem;.ErrCod = &amp;ErrCod; &amp;ErrorItem;.ErrDescripcion = &amp;ErrDesc; &amp;ErrorItem;.ErrDetalle = \'Valor inv\xc3\xa1lido en Tipo de Sujeto Extranejro [0=Persona Jur\xc3\xaddica; 1=Persona F\xc3\xadsica; 2=Otro].\'\n            &amp;Messages;.Add(&amp;ErrorItem;)\n            &amp;ErrorItem; = New XML_Errores.Error()            \n        endif\n        //{ add -006-\n        //verificar que este en la collection el atributo VATN con un valor not empty\n        if &amp;Request;.SujExtranjero = 1\n            &amp;Ok;_Vat_Number = \'N\'\n            for &amp;Atributo; in &amp;Request;.Atributos\n                if upper(trim(&amp;Atributo;.CodAtributo)) = \'VATN\' and not &amp;Atributo;.Valor.isEmpty()\n                    &amp;Ok;_Vat_Number = \'S\'\n                    exit\n                endif    \n            endfor\n            if &amp;Ok;_Vat_Number = \'N\'\n                &amp;ErrorC;= \'ERR\'\n                &amp;ErrCod; = 103\n                call(PRecuperaDescripcionError, &amp;ErrCod;, &amp;ErrDesc; )\n                &amp;ErrorItem;.ErrCod = &amp;ErrCod; &amp;ErrorItem;.ErrDescripcion = &amp;ErrDesc; &amp;ErrorItem;.ErrDetalle = \'Debe indicar el Nro. de Identificacion Tributaria para sujetos del exterior (Atributo VATN).\'\n                &amp;Messages;.Add(&amp;ErrorItem;)\n                &amp;ErrorItem; = New XML_Errores.Error()            \n            endif\n        endif\n        // -006- }\n        //{ add -004-\n    endif\n    //{ add -001-\n//    if &amp;Request;.TpoSujeto.IsEmpty() or (&amp;Request;.TpoSujeto &lt;&gt; 1 and &amp;Request;.TpoSujeto &lt;&gt; 2 and &amp;Request;.TpoSujeto &lt;&gt; 3 and &amp;Request;.TpoSujeto &lt;&gt; 6 and &amp;Request;.TpoSujeto &lt;&gt; 7) //DEL -004-\n    if &amp;Request;.TpoSujeto.IsEmpty() //add -004-\n        &amp;ErrorC;= \'ERR\'\n        &amp;ErrCod; = 103\n        call(PRecuperaDescripcionError, &amp;ErrCod;, &amp;ErrDesc; )\n        &amp;ErrorItem;.ErrCod = &amp;ErrCod; &amp;ErrorItem;.ErrDescripcion = &amp;ErrDesc; //{ add -004-\n        &amp;ErrorItem;.ErrDetalle = \'Valor inv\xc3\xa1lido en Tipo de Sujeto [\' \n        for each PERTpoId\n            &amp;ErrorItem;.ErrDetalle += trim(PERTpoId.ToString()) + \'=\' + PERTpoDes.Trim() + \'; \'\n        endfor\n        &amp;ErrorItem;.ErrDetalle += \']\'\n        // -004- }\n//        &amp;ErrorItem;.ErrDetalle = \'Valor inv\xc3\xa1lido en Tipo de Sujeto [1=Cliente de Motores; 2=Cliente de Omnibus; 3=Cliente de Camiones; 4=Concesionario; 5= 6=Proveedor; 7=Cliente y Proveedor].\' //DEL -004-\n        &amp;Messages;.Add(&amp;ErrorItem;)\n        &amp;ErrorItem; = New XML_Errores.Error()  \n    //{ add -004-\n    else \n        &amp;PerTpoId; = &amp;Request;.TpoSujeto\n        for each\n        where PERTpoId = &amp;PerTpoId; //OK\n        when none\n            &amp;ErrorC;= \'ERR\'\n            &amp;ErrCod; = 103\n            call(PRecuperaDescripcionError, &amp;ErrCod;, &amp;ErrDesc; )\n            &amp;ErrorItem;.ErrCod = &amp;ErrCod; &amp;ErrorItem;.ErrDescripcion = &amp;ErrDesc; &amp;ErrorItem;.ErrDetalle = \'Valor inv\xc3\xa1lido en Tipo de Sujeto [\' \n            for each PERTpoId\n                &amp;ErrorItem;.ErrDetalle += trim(PERTpoId.ToString()) + \'=\' + PERTpoDes.Trim() + \'; \'\n            endfor\n            &amp;ErrorItem;.ErrDetalle += \']\'\n            &amp;Messages;.Add(&amp;ErrorItem;)\n            &amp;ErrorItem; = New XML_Errores.Error() \n        endfor\n    // -004- }    \n    endif\n    // -001- }\n    \n    //Si existe domicilio, debe validar los datos obligatorios (M) ver definici\xc3\xb3n del XML de Alta de Sujeto.\n    &amp;OkDomPrincipal; = 0 //add -002-\n    for &amp;Domicilio; in &amp;Request;.Domicilios\n        //{ add -002-\n        //verifico Obligatorio Domicilio Principal\n        if &amp;Domicilio;.TpoDom = 1 \n            &amp;OkDomPrincipal; = 1 \n        endif\n        // -002- }\n        //Tipo de Domicilio (M) [1=Fiscal ; 2=Jurisdicci\xc3\xb3n Principal]\n        if &amp;Domicilio;.TpoDom.IsEmpty() and &amp;Domicilio;.TpoDom &lt;&gt; 1 and &amp;Domicilio;.TpoDom &lt;&gt; 2\n            &amp;ErrorC;= \'ERR\'\n            &amp;ErrCod; = 103\n            call(PRecuperaDescripcionError, &amp;ErrCod;, &amp;ErrDesc; )\n            &amp;ErrorItem;.ErrCod = &amp;ErrCod; &amp;ErrorItem;.ErrDescripcion = &amp;ErrDesc; &amp;ErrorItem;.ErrDetalle = \'Valor inv\xc3\xa1lido en Tipo de Domicilio [1=Fiscal ; 2=Jurisdicci\xc3\xb3n Principal].\'\n            &amp;Messages;.Add(&amp;ErrorItem;)\n            &amp;ErrorItem; = New XML_Errores.Error()            \n        endif\n        //C\xc3\xb3digo Postal (M)\n        if &amp;Domicilio;.CodPostal.IsEmpty()\n            &amp;ErrorC;= \'ERR\'\n            &amp;ErrCod; = 103\n            call(PRecuperaDescripcionError, &amp;ErrCod;, &amp;ErrDesc; )\n            &amp;ErrorItem;.ErrCod = &amp;ErrCod; &amp;ErrorItem;.ErrDescripcion = &amp;ErrDesc; &amp;ErrorItem;.ErrDetalle = \'Codigo Postal no puede ser nulo.\'\n            &amp;Messages;.Add(&amp;ErrorItem;)\n            &amp;ErrorItem; = New XML_Errores.Error()\n        endif\n        //Nombre de Calle (M)\n        if &amp;Domicilio;.Calle.IsEmpty()\n            &amp;ErrorC;= \'ERR\'\n            &amp;ErrCod; = 103\n            call(PRecuperaDescripcionError, &amp;ErrCod;, &amp;ErrDesc; )\n            &amp;ErrorItem;.ErrCod = &amp;ErrCod; &amp;ErrorItem;.ErrDescripcion = &amp;ErrDesc; &amp;ErrorItem;.ErrDetalle = \'Calle no puede ser nulo.\'\n            &amp;Messages;.Add(&amp;ErrorItem;)\n            &amp;ErrorItem; = New XML_Errores.Error()            \n        endif\n        //N\xc3\xbamero de Puerta (M)         \n        if &amp;Domicilio;.NumeroCalle.IsEmpty()\n            &amp;ErrorC;= \'ERR\'\n            &amp;ErrCod; = 103\n            call(PRecuperaDescripcionError, &amp;ErrCod;, &amp;ErrDesc; )\n            &amp;ErrorItem;.ErrCod = &amp;ErrCod; &amp;ErrorItem;.ErrDescripcion = &amp;ErrDesc; &amp;ErrorItem;.ErrDetalle = \'El Numero de Calle no puede ser nulo.\'\n            &amp;Messages;.Add(&amp;ErrorItem;)\n            &amp;ErrorItem; = New XML_Errores.Error()            \n        endif\n    endfor\n    //{ add -002-\n    if &amp;OkDomPrincipal; = 0\n        &amp;ErrorC;= \'ERR\'\n        &amp;ErrCod; = 103\n        call(PRecuperaDescripcionError, &amp;ErrCod;, &amp;ErrDesc; )\n        &amp;ErrorItem;.ErrCod = &amp;ErrCod; &amp;ErrorItem;.ErrDescripcion = &amp;ErrDesc; &amp;ErrorItem;.ErrDetalle = \'Debe indicar al menos un Domicilio Principal (Tipo de Domicilio = 1).\'\n        &amp;Messages;.Add(&amp;ErrorItem;)\n        &amp;ErrorItem; = New XML_Errores.Error()            \n    endif\n    // -002- }\n    //{ add -006-\n    //verificar que todos los CodAtributo esten en la tabla Atr\n    &amp;Ok;_Cod_Atributo = \'S\'\n    &amp;Ok;_Val_Atributo = \'S\'\n    for &amp;Atributo; in &amp;Request;.Atributos\n        &amp;AtrCod; = &amp;Atributo;.CodAtributo\n        if &amp;Ok;_Cod_Atributo = \'S\'\n            for each\n                where AtrCod = &amp;AtrCod; when none\n                &amp;Ok;_Cod_Atributo = \'N\'                 \n            endfor\n        endif\n        if &amp;Ok;_Cod_Atributo = \'N\' \n            exit\n        endif\n        if &amp;Atributo;.Valor.IsEmpty() \n            &amp;Ok;_Val_Atributo = \'N\'\n            exit\n        endif\n    endfor   \n    if &amp;Ok;_Cod_Atributo = \'N\' \n        &amp;ErrorC;= \'ERR\'\n        &amp;ErrCod; = 102\n        call(PRecuperaDescripcionError, &amp;ErrCod;, &amp;ErrDesc; )\n        &amp;ErrorItem;.ErrCod = &amp;ErrCod; &amp;ErrorItem;.ErrDescripcion = &amp;ErrDesc; &amp;ErrorItem;.ErrDetalle = \'El Atributo indicado (\'+trim(&amp;Atributo;.CodAtributo)+\') no existe en el maestro de atributos.\'\n        &amp;Messages;.Add(&amp;ErrorItem;)\n        &amp;ErrorItem; = New XML_Errores.Error()            \n    endif\n    if &amp;Ok;_Val_Atributo = \'N\' \n        &amp;ErrorC;= \'ERR\'\n        &amp;ErrCod; = 102\n        call(PRecuperaDescripcionError, &amp;ErrCod;, &amp;ErrDesc; )\n        &amp;ErrorItem;.ErrCod = &amp;ErrCod; &amp;ErrorItem;.ErrDescripcion = &amp;ErrDesc; &amp;ErrorItem;.ErrDetalle = \'El valor para el Atributo &quot;\'+trim(&amp;Atributo;.CodAtributo)+\'&quot; se encuentra vacio.\'\n        &amp;Messages;.Add(&amp;ErrorItem;)\n        &amp;ErrorItem; = New XML_Errores.Error()            \n    endif\n    // -006 }\n    if &amp;Messages;.Count &gt; 0 or &amp;ErrCod; &lt;&gt; 0 or not &amp;ErrorC;.IsEmpty()\n        return\n    endif\nendsub\n\nsub \'Alta Sujeto\'\n     //Numero Persona\n//  &amp;PerCod; = PGenerar_ID.Udp(\'Sujeto\') \n    &amp;PerCod; = PGenerar_ID_TablaGIS20(\'PERSUJ\') //ADD ADB 17-12-09\n    //PER\n    new\n        CiaCod = &amp;Request;.CiaCod\n        PerCod = &amp;PerCod; when duplicate\n        &amp;ErrorC;= \'ERR\'\n        &amp;ErrCod; = 102\n        call(PRecuperaDescripcionError, &amp;ErrCod;, &amp;ErrDesc; )\n        &amp;ErrorItem;.ErrCod = &amp;ErrCod; &amp;ErrorItem;.ErrDescripcion = &amp;ErrDesc; &amp;ErrorItem;.ErrDetalle = \'Sujeto ya existe (PER).\'\n        &amp;Messages;.Add(&amp;ErrorItem;)\n        &amp;ErrorItem; = New XML_Errores.Error()  \n        return\n    endnew\n    //PERSUJ\n    new\n        PerCod = &amp;PerCod; PerNom = &amp;Request;.RazonSocial \n        PerApe.SetEmpty() \n        PerCUI = &amp;Request;.DocNro\n        PerIB = &amp;Request;.NroIIBB //add -007-\n        PerCp.SetEmpty()    \n        PerTel = &amp;Request;.ContactoTel\n        PerFax.SetEmpty()\n        PerMai = &amp;Request;.ContactoMail\n        CodSolom.SetEmpty()\n        PerSuc.SetEmpty()\n        PerCC.SetEmpty()\n        PerUN.SetEmpty()\n        PerIntSN.SetEmpty()\n        PerDtoCod.SetEmpty()\n        PerConSN.SetEmpty()\n        PerTpoPyt.SetEmpty()\n        TaxPrfCod.SetEmpty()\n        PerStsAct = EstadoSujeto.Deshabilitado \n        PerBUsSN.SetEmpty()\n        PerCAI.SetEmpty()\n        PerCAIVTO.SetEmpty()\n        PerCrtFis.SetEmpty()\n        PerIva.SetEmpty()\n        PerSitIVA.SetEmpty()\n        PerIdeTpo.SetEmpty()\n        PERSUJFchAlta = now()    \n        PERSUJFchAct = now()\n        PERSUJUserAlta = &amp;Request;.Audit_Usuario\n        PERSUJUserAct = &amp;Request;.Audit_Usuario\n        PERCONIIBBID = iif(&amp;Request;.CONIIBB.IsEmpty(), 1, &amp;Request;.CONIIBB) //add -007-\n        PERCONIVAID = iif(&amp;Request;.CONIVA.IsEmpty(), 6, &amp;Request;.CONIVA) //add -007-\n        PERCONGANID = iif(&amp;Request;.CONGAN.IsEmpty(), 4, &amp;Request;.CONGAN) //add -007-\n        PERTpoId = &amp;Request;.TpoSujeto //add 001\n        PERSUJAgtePerIVA.SetEmpty()\n        PERSUJAgteRetIVA.SetEmpty()\n        PERSUJTpoSitFiscal.SetEmpty()\n        TPODOCId = &amp;Request;.DocTpo\n        PerInsGranos.SetEmpty()\n        PERSITFISID.SetEmpty()\n        PERSUJAgteAutoImpGan.SetEmpty()\n        PERSUJAgteSijyp.SetEmpty()\n        PerPais = &amp;Request;.CodPais \n        PerSujSistema  = &amp;Request;.Audit_Sistema\n        PerSujEsEmpleador.SetEmpty()\n        PERSujExtranjero = &amp;Request;.SujExtranjero\n        &amp;TpoSujetoExtranejro; = &amp;Request;.TpoSujExtranjero\n        PERTpoExtranjero = TipoSujExtr.Convert(&amp;TpoSujetoExtranejro;)\n        PERParaisoFiscal.SetEmpty()\n        PERTpoRelacion.SetEmpty()\n        PerCntNom = &amp;Request;.ContactoNombre\n        PerCntApe = &amp;Request;.ContactoApellido \n        PERInsDerRegInspecc.SetEmpty()\n        PERInsDGR.SetEmpty()\n        PERInsOtroGrav.SetEmpty()\n        PerCntCom = &amp;Request;.Comentario\n//        PerTpoEmails.SetEmpty()\n        PERSUJ_Alias = &amp;Request;.Audit_Usuario\n        PERSUJ_Estado = EstadoDatos.Pendiente\n        PERSUJ_SinCertificado.SetEmpty()\n//        &amp;Request;.TpoCtaBco //FALTA ATT\n//        &amp;Request;.Audit_FchAlta       //NO USO ESTA FECHA USO LA DEL SISTEMA\n    when duplicate\n        &amp;ErrorC;= \'ERR\'\n        &amp;ErrCod; = 102\n        call(PRecuperaDescripcionError, &amp;ErrCod;, &amp;ErrDesc; )\n        &amp;ErrorItem;.ErrCod = &amp;ErrCod; &amp;ErrorItem;.ErrDescripcion = &amp;ErrDesc; &amp;ErrorItem;.ErrDetalle = \'Sujeto ya existe (PERSUJ).\'\n        &amp;Messages;.Add(&amp;ErrorItem;)\n        &amp;ErrorItem; = New XML_Errores.Error()  \n        return\n    endnew\nendsub\n\nsub \'Alta Domicilios\'\n    for &amp;Domicilio; in &amp;Request;.Domicilios\n        //&amp;PerOrden; += 1 //DEL -003-\n        //PERDOM\n        new\n//          PERDOMID = PGenerar_ID.UDP(\'Domicilio\') \n            PERDOMID = PGenerar_ID_TablaGIS20(\'PERDOM\') //ADD ADB 17-12-09\n            PerCod = &amp;PerCod; //PEROrden = &amp;PerOrden; //DEL -003-\n            PERTPODom.SetEmpty()\n            PERDOMCalle= &amp;Domicilio;.Calle\n            PERDOMNumero = &amp;Domicilio;.NumeroCalle\n            PERDOMTorre = &amp;Domicilio;.Torre\n            PERDOMMono = &amp;Domicilio;.Monoblock\n            PERDOMNroPta = &amp;Domicilio;.NumeroCalle\n            PERDOMPlanta = &amp;Domicilio;.Piso.ToString()\n            PERDOMTel = &amp;Domicilio;.Telefono\n            PERDOMPiso = &amp;Domicilio;.Piso\n            PERDOMDepto = &amp;Domicilio;.Dpto\n            PERDOMUserAlta = &amp;Request;.Audit_Usuario\n            PERDOMFchAlta = now()\n            PERDOMUserAct = &amp;Request;.Audit_Usuario\n            PERDOMFchAct = now()\n            DOMId = &amp;Domicilio;.TpoDom\n            do \'Busco Id Cod. Postal\'\n            LOCPOSID = &amp;LocPosId; PERDOMCodigoPostal = &amp;Domicilio;.CodPostal\n        when duplicate\n            &amp;ErrorC;= \'ERR\'\n            &amp;ErrCod; = 102\n            call(PRecuperaDescripcionError, &amp;ErrCod;, &amp;ErrDesc; )\n            &amp;ErrorItem;.ErrCod = &amp;ErrCod; &amp;ErrorItem;.ErrDescripcion = &amp;ErrDesc; &amp;ErrorItem;.ErrDetalle = \'Domicilio ya existe (PERDOM).\'\n            &amp;Messages;.Add(&amp;ErrorItem;)\n            &amp;ErrorItem; = New XML_Errores.Error()  \n            return\n        endnew\n    endfor\nendsub\n\nsub \'Busco Id Cod. Postal\'\n    &amp;LocPosId;.SetEmpty()\n    if not &amp;Domicilio;.CodPostal.IsEmpty() and &amp;Request;.SujExtranjero.IsEmpty() //add -005-\n        for each\n        where LOCPOSCodigoPostal = &amp;Domicilio;.CodPostal\n            &amp;LocPosId; = LOCPOSID\n            exit\n        //{ add -002-\n        when none\n            &amp;ErrorC;= \'ERR\'\n            &amp;ErrCod; = 900\n            call(PRecuperaDescripcionError, &amp;ErrCod;, &amp;ErrDesc; )\n            &amp;ErrorItem;.ErrCod = &amp;ErrCod; &amp;ErrorItem;.ErrDescripcion = &amp;ErrDesc; &amp;ErrorItem;.ErrDetalle = \'No se encontr\xc3\xb3 una coincidencia de Codigo Postal en el sistema. Se utilizar\xc3\xa1 un valor default.\'\n            &amp;Messages;.Add(&amp;ErrorItem;)\n            &amp;ErrorItem; = New XML_Errores.Error()\n            &amp;LocPosId; = 99999999 //codigo default para Localidad, Departamento y Provincia = SIN DEFINIR\n        // -002- }\n        endfor\n    //{ add -005-\n    else\n        for each\n        where PAISId = &amp;Request;.CodPais \n            &amp;LocPosId; = LOCPOSID\n            exit\n        when none\n            &amp;ErrorC;= \'ERR\'\n            &amp;ErrCod; = 900\n            call(PRecuperaDescripcionError, &amp;ErrCod;, &amp;ErrDesc; )\n            &amp;ErrorItem;.ErrCod = &amp;ErrCod; &amp;ErrorItem;.ErrDescripcion = &amp;ErrDesc; &amp;ErrorItem;.ErrDetalle = \'No se encontr\xc3\xb3 una coincidencia de Codigo Postal en el sistema. Se utilizar\xc3\xa1 un valor default.\'\n            &amp;Messages;.Add(&amp;ErrorItem;)\n            &amp;ErrorItem; = New XML_Errores.Error()\n            &amp;LocPosId; = 99999999 //codigo default para Localidad, Departamento y Provincia = SIN DEFINIR\n        endfor\n    endif\n    // -005- }\nendsub\n\nsub \'Finaliza\'\n    &amp;ErrorC;= \'OK\'\n    &amp;ErrCod; = 100\n    call(PRecuperaDescripcionError, &amp;ErrCod;, &amp;ErrDesc; )\n    &amp;ErrorItem;.ErrCod = &amp;ErrCod; &amp;ErrorItem;.ErrDescripcion = &amp;ErrDesc; &amp;ErrorItem;.ErrDetalle = \'Ejecuci\xc3\xb3n Satisfactoria.\'\n    &amp;Messages;.Add(&amp;ErrorItem;)\n    &amp;ErrorItem; = New XML_Errores.Error()\nendsub\n\n//{ add -006-\nsub \'Alta Atributos\'\n    for &amp;Atributo; in &amp;Request;.Atributos\n        new\n            PerCod = &amp;PerCod; AtrCod = &amp;Atributo;.CodAtributo\n            PERSUJATRVal = &amp;Atributo;.Valor\n        when duplicate\n            &amp;ErrorC;= \'ERR\'\n            &amp;ErrCod; = 102\n            call(PRecuperaDescripcionError, &amp;ErrCod;, &amp;ErrDesc; )\n            &amp;ErrorItem;.ErrCod = &amp;ErrCod; &amp;ErrorItem;.ErrDescripcion = &amp;ErrDesc; &amp;ErrorItem;.ErrDetalle = \'Atributo ya existe (ATR).\'\n            &amp;Messages;.Add(&amp;ErrorItem;)\n            &amp;ErrorItem; = New XML_Errores.Error()  \n            return\n//            PERSUJATRID = PGenerar_ID_Tabla(\'PERSUJATR\')\n        endnew\n//        &amp;AtributosSujeto;.Mode(\'INS\')\n//        &amp;AtributosSujeto;.AtrCod = &amp;Atributo;.CodAtributo\n//        &amp;AtributosSujeto;.PerCod = &amp;PerCod;\n//        &amp;AtributosSujeto;.PERSUJATRVal = &amp;Atributo;.Valor\n//        &amp;AtributosSujeto;.Save()\n//        &amp;AtributosSujeto; = New PERSUJATR001()\n    endfor\nendsub\n// -006- }\n</code></pre></p> <p align="right"><span style="font-size: 60%">Add a code snippet to your website: <a href="https://www.paste.org" target="_blank">www.paste.org</a></span></p> </body> </html>'